<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–£—á–µ–±–Ω—ã–π —á–∞—Ç-–±–æ—Ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: #111;
      color: #eee;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      background: #1e1e1e;
      padding: 0.75rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }

    header h1 {
      font-size: 1.1rem;
      margin: 0;
    }

    header button {
      background: none;
      border: none;
      color: #eee;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0.5rem;
      overflow-y: auto;
    }

    .message {
      display: flex;
      flex-direction: column;
      margin: 0.4rem 0;
      max-width: 80%;
      animation: fadeIn 0.3s ease;
    }

    .message.user {
      align-self: flex-end;
      align-items: flex-end;
    }

    .message.bot {
      align-self: flex-start;
      align-items: flex-start;
    }

    .bubble {
      padding: 0.7rem 1rem;
      border-radius: 1rem;
      line-height: 1.4;
    }

    .user .bubble {
      background: #007bff;
      color: white;
      border-bottom-right-radius: 0.3rem;
    }

    .bot .bubble {
      background: #333;
      border-bottom-left-radius: 0.3rem;
    }

    .timestamp {
      font-size: 0.7rem;
      opacity: 0.6;
      margin-top: 0.2rem;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 0.5rem 0;
    }

    .chip {
      background: #444;
      padding: 0.4rem 0.8rem;
      border-radius: 1rem;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s;
    }

    .chip:hover {
      background: #666;
    }

    .quick-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      padding: 0.4rem;
      background: #1e1e1e;
    }

    .quick-actions button {
      flex: 1;
      padding: 0.5rem;
      border: none;
      border-radius: 0.6rem;
      font-size: 0.85rem;
      cursor: pointer;
      background: #333;
      color: #eee;
      transition: background 0.2s;
    }

    .quick-actions button.active {
      background: #007bff;
      color: #fff;
    }

    .input-container {
      display: flex;
      gap: 0.5rem;
      padding: 0.5rem;
      background: #1e1e1e;
      flex-shrink: 0;
    }

    textarea {
      flex: 1;
      resize: none;
      border: none;
      border-radius: 1.2rem;
      padding: 0.7rem 1rem;
      font-size: 1rem;
      background: #333;
      color: #fff;
      box-sizing: border-box;
    }

    button.send {
      border: none;
      border-radius: 50%;
      background: #007bff;
      color: #fff;
      font-size: 1.2rem;
      width: 42px;
      height: 42px;
      cursor: pointer;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    button.send:active {
      background: #0056b3;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 768px) {
      .message { max-width: 95%; }
      textarea { font-size: 0.95rem; }
      .chip { font-size: 0.85rem; }
      .quick-actions button { font-size: 0.8rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>–£—á–µ–±–Ω—ã–π —á–∞—Ç-–±–æ—Ç</h1>
    <button onclick="exportChat()">üì•</button>
  </header>
  
  <div class="chat-container" id="chat">
    <div class="message bot">
      <div class="bubble">–ü—Ä–∏–≤–µ—Ç! üëã –í—ã–±–µ—Ä–∏ —Ç–µ–º—É –∏–ª–∏ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å.</div>
      <div class="timestamp"></div>
    </div>
    <div class="chips" id="chips"></div>
  </div>

  <div class="quick-actions">
    <button id="btn-normal" onclick="setMode('normal', this)">üü¢ –û–±—ã—á–Ω—ã–π</button>
    <button id="btn-socratic" onclick="setMode('socratic', this)">üîµ –°–æ–∫—Ä–∞—Ç–∏—á–µ—Å–∫–∏–π</button>
    <button id="btn-teacher" onclick="setMode('teacher', this)">üü£ –£—á–∏—Ç–µ–ª—å</button>
    <button onclick="startQuiz()">üé≤ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</button>
    <button onclick="resetChat()">üîÑ –°–±—Ä–æ—Å</button>
  </div>

  <div class="input-container">
    <textarea id="userInput" rows="1" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
    <button class="send" onclick="sendMessage()">‚úàÔ∏è</button>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const input = document.getElementById('userInput');
    const chips = document.getElementById('chips');

    let mode = "normal";
    let currentTopic = null;
    let quizActive = false;
    let quizAnswer = null;

    const variants = {
      greet: ["–ü—Ä–∏–≤–µ—Ç! üëã", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üòä", "–•–µ–π! üôå"],
      factIntro: ["–ö—Å—Ç–∞—Ç–∏,", "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç:", "–ó–Ω–∞–µ—à—å –ª–∏ —Ç—ã, —á—Ç–æ"],
      correct: ["–í–µ—Ä–Ω–æ! üéâ", "–û—Ç–ª–∏—á–Ω–æ! ‚úÖ", "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üëå"],
      wrong: ["–ù–µ —Å–æ–≤—Å–µ–º —Ç–∞–∫... ü§î", "–ù–µ–≤–µ—Ä–Ω–æ üò¢", "–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!"]
    };

    const topics = {
      "–ê–Ω—Ç–∏—á–Ω–æ—Å—Ç—å": {
        facts: ["–ê–Ω—Ç–∏—á–Ω–æ—Å—Ç—å ‚Äî —ç–ø–æ—Ö–∞ –¥—Ä–µ–≤–Ω–µ–≥—Ä–µ—á–µ—Å–∫–æ–π –∏ –¥—Ä–µ–≤–Ω–µ—Ä–∏–º—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä.", "–ì–ª–∞–≤–Ω—ã–µ –∂–∞–Ω—Ä—ã ‚Äî —Å–∫—É–ª—å–ø—Ç—É—Ä–∞, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —Ç–µ–∞—Ç—Ä."],
        questions: ["–ß—Ç–æ —Ç–µ–±–µ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –≤ –∞–Ω—Ç–∏—á–Ω–æ–π –∫—É–ª—å—Ç—É—Ä–µ?", "–ö–∞–∫ –¥—É–º–∞–µ—à—å, –∑–∞—á–µ–º —Å—Ç—Ä–æ–∏–ª–∏ –∞–º—Ñ–∏—Ç–µ–∞—Ç—Ä—ã?"],
        task: "–ù–∞–π–¥–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–Ω—Ç–∏—á–Ω–æ–≥–æ —Ö—Ä–∞–º–∞ –∏ —Å—Ä–∞–≤–Ω–∏ –µ–≥–æ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∑–¥–∞–Ω–∏—è–º–∏."
      },
      "–†–µ–Ω–µ—Å—Å–∞–Ω—Å": {
        facts: ["–†–µ–Ω–µ—Å—Å–∞–Ω—Å ‚Äî —ç–ø–æ—Ö–∞ –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è –≤ –ï–≤—Ä–æ–ø–µ XV‚ÄìXVI –≤–≤.", "–ì–ª–∞–≤–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã: –õ–µ–æ–Ω–∞—Ä–¥–æ –¥–∞ –í–∏–Ω—á–∏, –ú–∏–∫–µ–ª–∞–Ω–¥–∂–µ–ª–æ, –†–∞—Ñ–∞—ç–ª—å."],
        questions: ["–ß—Ç–æ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–Ω–µ—Å –†–µ–Ω–µ—Å—Å–∞–Ω—Å –≤ –∏—Å–∫—É—Å—Å—Ç–≤–æ?", "–ü–æ—á–µ–º—É –∏–Ω—Ç–µ—Ä–µ—Å –∫ —á–µ–ª–æ–≤–µ–∫—É —Å—Ç–∞–ª –≥–ª–∞–≤–Ω—ã–º?"],
        task: "–ü–æ–ø—Ä–æ–±—É–π –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –ø–æ—Ä—Ç—Ä–µ—Ç –≤ —Å—Ç–∏–ª–µ –†–µ–Ω–µ—Å—Å–∞–Ω—Å–∞."
      },
      "–ë–∞—Ä–æ–∫–∫–æ": {
        facts: ["–ë–∞—Ä–æ–∫–∫–æ ‚Äî —Å—Ç–∏–ª—å –ø—ã—à–Ω–æ—Å—Ç–∏ –∏ –¥–∏–Ω–∞–º–∏–∫–∏.", "–í –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ ‚Äî –∏–∑–æ–≥–Ω—É—Ç—ã–µ –ª–∏–Ω–∏–∏, –±–æ–≥–∞—Ç—ã–π –¥–µ–∫–æ—Ä."],
        questions: ["–ö–∞–∫ –±–∞—Ä–æ–∫–∫–æ –æ—Ç–ª–∏—á–∞–ª–æ—Å—å –æ—Ç –†–µ–Ω–µ—Å—Å–∞–Ω—Å–∞?", "–ü–æ—á–µ–º—É –ª—é–¥—è–º –Ω—Ä–∞–≤–∏–ª—Å—è —Ç–∞–∫–æ–π —Å—Ç–∏–ª—å?"],
        task: "–°—Ä–∞–≤–Ω–∏ –∫–∞—Ä—Ç–∏–Ω—É –ö–∞—Ä–∞–≤–∞–¥–∂–æ –∏ –†–∞—Ñ–∞—ç–ª—è."
      },
      "–ò–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏–∑–º": {
        facts: ["–ò–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏–∑–º –≤–æ–∑–Ω–∏–∫ –≤–æ –§—Ä–∞–Ω—Ü–∏–∏ XIX –≤–µ–∫–∞.", "–•—É–¥–æ–∂–Ω–∏–∫–∏: –ú–æ–Ω–µ, –†–µ–Ω—É–∞—Ä, –î–µ–≥–∞."],
        questions: ["–ß—Ç–æ –∑–Ω–∞—á–∏—Ç '–ø–æ–π–º–∞—Ç—å –º–æ–º–µ–Ω—Ç' –≤ –∏—Å–∫—É—Å—Å—Ç–≤–µ?", "–ß–µ–º –∏–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏—Å—Ç—ã –æ—Ç–ª–∏—á–∞–ª–∏—Å—å –æ—Ç –∞–∫–∞–¥–µ–º–∏–∫–æ–≤?"],
        task: "–ù–∞—Ä–∏—Å—É–π –±—ã—Å—Ç—Ä–æ –ø–µ–π–∑–∞–∂, –∫–∞–∫ –±—É–¥—Ç–æ –∏–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏—Å—Ç."
      }
    };

    const quizzes = [
      {
        q: "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª ¬´–ú–æ–Ω—É –õ–∏–∑—É¬ª?",
        options: ["–ú–∏–∫–µ–ª–∞–Ω–¥–∂–µ–ª–æ", "–õ–µ–æ–Ω–∞—Ä–¥–æ –¥–∞ –í–∏–Ω—á–∏", "–†–∞—Ñ–∞—ç–ª—å"],
        answer: 2
      },
      {
        q: "–ì–¥–µ –∑–∞—Ä–æ–¥–∏–ª—Å—è –∏–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏–∑–º?",
        options: ["–§—Ä–∞–Ω—Ü–∏—è", "–ò—Ç–∞–ª–∏—è", "–ì–µ—Ä–º–∞–Ω–∏—è"],
        answer: 1
      }
    ];

    function addMessage(text, sender="user") {
      const msg = document.createElement('div');
      msg.className = `message ${sender}`;
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;
      const ts = document.createElement('div');
      ts.className = 'timestamp';
      ts.textContent = new Date().toLocaleTimeString().slice(0,5);
      msg.appendChild(bubble);
      msg.appendChild(ts);
      chat.insertBefore(msg, chips);
      chat.scrollTop = chat.scrollHeight;
    }

    function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      addMessage(text, "user");
      input.value = "";
      handleUserInput(text);
    }

    function handleUserInput(text) {
      if (quizActive) {
        let choice = parseInt(text);
        if (choice === quizAnswer) {
          addMessage(randomFrom(variants.correct), "bot");
        } else {
          addMessage(randomFrom(variants.wrong), "bot");
        }
        quizActive = false;
        return;
      }

      if (text.startsWith("/")) {
        handleCommand(text);
      } else if (currentTopic) {
        respondOnTopic(text);
      } else {
        addMessage("–ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏ —Ç–µ–º—É üëá", "bot");
      }
    }

    function handleCommand(cmd) {
      if (cmd === "/help") {
        addMessage("–ö–æ–º–∞–Ω–¥—ã: /topic [—Ç–µ–º–∞], /mode [normal|socratic|teacher], /quiz, /reset", "bot");
      } else if (cmd.startsWith("/topic")) {
        const parts = cmd.split(" ");
        const t = parts[1];
        if (topics[t]) {
          currentTopic = t;
          addMessage("–¢–µ–º–∞ –≤—ã–±—Ä–∞–Ω–∞: " + t, "bot");
          addMessage(randomFrom(variants.factIntro) + " " + topics[t].facts[0], "bot");
        } else {
          addMessage("–¢–∞–∫–æ–π —Ç–µ–º—ã –Ω–µ—Ç. –î–æ—Å—Ç—É–ø–Ω—ã–µ: " + Object.keys(topics).join(", "), "bot");
        }
      } else if (cmd.startsWith("/mode")) {
        const parts = cmd.split(" ");
        const m = parts[1];
        if (["normal","socratic","teacher"].includes(m)) {
          mode = m;
          addMessage("–†–µ–∂–∏–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " + m, "bot");
        } else {
          addMessage("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º", "bot");
        }
      } else if (cmd === "/quiz") {
        startQuiz();
      } else if (cmd === "/reset") {
        resetChat();
      } else {
        addMessage("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –í–≤–µ–¥–∏ /help", "bot");
      }
    }

    function respondOnTopic(userText) {
      const t = topics[currentTopic];
      addMessage(randomFrom(variants.factIntro) + " " + t.facts[Math.floor(Math.random() * t.facts.length)], "bot");

      if (mode === "socratic") {
        addMessage(t.questions[Math.floor(Math.random() * t.questions.length)], "bot");
      } else if (mode === "teacher") {
        addMessage("–ó–∞–¥–∞–Ω–∏–µ: " + t.task, "bot");
      }
    }

    function startQuiz() {
      const q = quizzes[Math.floor(Math.random() * quizzes.length)];
      addMessage("–í–∏–∫—Ç–æ—Ä–∏–Ω–∞: " + q.q, "bot");
      q.options.forEach((opt, i) => addMessage(`${i+1}) ${opt}`, "bot"));
      quizActive = true;
      quizAnswer = q.answer;
    }

    function randomFrom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function exportChat() {
      let text = "";
      document.querySelectorAll(".message").forEach(msg => {
        const who = msg.classList.contains("user") ? "–í—ã" : "–ë–æ—Ç";
        const bubble = msg.querySelector(".bubble").textContent;
        text += `${who}: ${bubble}\n`;
      });
      const blob = new Blob([text], {type: "text/plain"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "dialog.txt";
      a.click();
      URL.revokeObjectURL(url);
    }

    function setMode(m, btn) {
      mode = m;
      addMessage("–†–µ–∂–∏–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " + m, "bot");
      document.querySelectorAll(".quick-actions button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    }

    function resetChat() {
      currentTopic = null;
      addMessage("–ß–∞—Ç —Å–±—Ä–æ—à–µ–Ω. –í—ã–±–µ—Ä–∏ —Ç–µ–º—É –∑–∞–Ω–æ–≤–æ.", "bot");
    }

    input.addEventListener("keypress", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // —Å–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏-—á–∏–ø—ã —Ç–µ–º
    Object.keys(topics).forEach(t => {
      const chip = document.createElement('div');
      chip.className = "chip";
      chip.textContent = t;
      chip.onclick = () => {
        currentTopic = t;
        addMessage("–¢–µ–º–∞ –≤—ã–±—Ä–∞–Ω–∞: " + t, "bot");
        addMessage(randomFrom(variants.factIntro) + " " + topics[t].facts[0], "bot");
      };
      chips.appendChild(chip);
    });
  </script>
</body>
</html>